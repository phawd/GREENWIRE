#!/usr/bin/env python3
"""
Enhanced EMV Data Translation Script
===================================
More comprehensive translation of Chinese content to English
"""

import os
import re
from pathlib import Path

class EnhancedEMVTranslator:
    def __init__(self, base_path):
        self.base_path = Path(base_path)
        
        # Comprehensive translation dictionary
        self.translations = {
            # Website/UI elements
            "é¦–é¡µ": "Home",
            "å½’æ¡£": "Archives", 
            "æ ‡ç­¾": "Tags",
            "å‹é“¾": "Friends",
            "å…³äºŽ": "About",
            "ä¸Šä¸€ç¯‡": "Previous",
            "ä¸‹ä¸€ç¯‡": "Next",
            "ç›®å½•": "Contents",
            "ç‰ˆæƒæ‰€æœ‰": "Copyright",
            "ä¸»é¢˜": "Theme",
            "æŠ€æœ¯æ”¯æŒ": "Powered by",
            
            # EMV/Technical terms
            "ç»ˆç«¯äº¤æ˜“ç±»åž‹": "Terminal Transaction Type",
            "ç»ˆç«¯": "Terminal",
            "äº¤æ˜“ç±»åž‹": "Transaction Type",
            "äº¤æ˜“": "Transaction",
            "ç±»åž‹": "Type",
            "å•†å“": "Goods",
            "æœåŠ¡": "Service", 
            "çŽ°é‡‘": "Cash",
            "é€€æ¬¾": "Refund",
            "ä½™é¢æŸ¥è¯¢": "Balance Inquiry",
            "è¿”çŽ°": "CashBack",
            "æŸ¥è¯¢": "Inquiry",
            "ä½™é¢": "Balance",
            
            # Android/Programming terms
            "æŽ§ä»¶": "Widget",
            "ç»„ä»¶": "Component",
            "åŽŸç”Ÿ": "Native", 
            "ä½¿ç”¨": "Using",
            "å®žçŽ°": "Implementation",
            "ä¸Ž": "and",
            "äº’è½¬": "Mutual Conversion",
            "è½¬æ¢": "Conversion",
            "æ–¹æ³•": "Method",
            "å‡½æ•°": "Function",
            "ç±»": "Class",
            "å¯¹è±¡": "Object",
            "å±žæ€§": "Property",
            "é…ç½®": "Configuration",
            "è®¾ç½®": "Settings",
            "åº”ç”¨": "Application",
            "ç¨‹åº": "Program",
            "ä»£ç ": "Code",
            "ç¤ºä¾‹": "Example",
            "æ¼”ç¤º": "Demo",
            "å¸ƒå±€": "Layout",
            "æ´»åŠ¨": "Activity",
            "é¡µé¢": "Page",
            "ç•Œé¢": "Interface",
            "æ•°æ®": "Data",
            
            # Cloud/Business terms
            "è…¾è®¯äº‘": "Tencent Cloud",
            "äº‘äº§å“": "Cloud Products",
            "é™æ—¶ç§’æ€": "Limited Time Flash Sale", 
            "çˆ†æ¬¾": "Popular",
            "äº‘æœåŠ¡å™¨": "Cloud Server",
            "é¦–å¹´": "First Year",
            "å…ƒ": "Yuan",
            "ä¼˜æƒ ": "Discount",
            "ç‰¹ä»·": "Special Price",
            
            # Common characters and phrases
            "å¹´": "Year",
            "æœˆ": "Month", 
            "æ—¥": "Day",
            "æ—¶": "Hour",
            "åˆ†": "Minute",
            "ç§’": "Second",
            "çš„": "of/the",
            "å’Œ": "and",
            "æˆ–": "or",
            "ä½†": "but",
            "æ˜¯": "is",
            "æœ‰": "have",
            "åœ¨": "in/at",
            "ä¸º": "for/as",
            "åˆ°": "to",
            "ä»Ž": "from",
            "ç”±": "by",
            "ä¸Ž": "with",
            "åŠ": "and",
            "ç­‰": "etc",
            "æ‰€": "place/what",
            "å¯": "can",
            "å°†": "will",
            "å·²": "already",
            "è¢«": "by/passive",
            "æŠŠ": "take/handle",
            "è®©": "let/make",
            "ç»™": "give/to",
            "å¯¹": "for/to",
            "å‘": "toward",
            "é€šè¿‡": "through",
            "æ ¹æ®": "according to",
            "åŸºäºŽ": "based on",
            "å…³äºŽ": "about",
            "å¦‚æžœ": "if",
            "å¦‚ä½•": "how",
            "ä»€ä¹ˆ": "what",
            "å“ªé‡Œ": "where",
            "ä»€ä¹ˆæ—¶å€™": "when",
            "ä¸ºä»€ä¹ˆ": "why",
            "æ€Žä¹ˆ": "how",
            "å¤šå°‘": "how much",
            
            # Numbers (Chinese)
            "ä¸€": "1/one",
            "äºŒ": "2/two", 
            "ä¸‰": "3/three",
            "å››": "4/four",
            "äº”": "5/five",
            "å…­": "6/six",
            "ä¸ƒ": "7/seven",
            "å…«": "8/eight",
            "ä¹": "9/nine",
            "å": "10/ten",
            "ç™¾": "hundred",
            "åƒ": "thousand",
            "ä¸‡": "ten thousand",
            
            # File/Document terms
            "æ–‡ä»¶": "File",
            "æ–‡æ¡£": "Document",
            "èµ„æ–™": "Data/Material",
            "ä¿¡æ¯": "Information",
            "å†…å®¹": "Content",
            "æ ¼å¼": "Format",
            "å¤§å°": "Size",
            "é•¿åº¦": "Length",
            "å®½åº¦": "Width",
            "é«˜åº¦": "Height",
            "é¢œè‰²": "Color",
            "èƒŒæ™¯": "Background",
            "å‰æ™¯": "Foreground",
            "å­—ä½“": "Font",
            "æ ·å¼": "Style",
            "æ¨¡æ¿": "Template",
            "ä¸»é¢˜": "Theme"
        }
    
    def comprehensive_translate(self, text):
        """Comprehensive translation using multiple strategies"""
        translated = text
        
        # Strategy 1: Direct word/phrase replacement
        for chinese, english in self.translations.items():
            translated = translated.replace(chinese, english)
        
        # Strategy 2: Handle remaining single Chinese characters
        # Replace any remaining Chinese characters with placeholder
        chinese_chars = re.findall(r'[\u4e00-\u9fff]', translated)
        for char in set(chinese_chars):
            if char not in self.translations:
                # Use a placeholder for untranslated characters
                translated = translated.replace(char, f"[CN:{char}]")
        
        return translated
    
    def deep_translate_file(self, file_path):
        """Perform deep translation of a single file"""
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
            
            # Check if translation is needed
            if not re.search(r'[\u4e00-\u9fff]', content):
                return False  # No Chinese characters
            
            # Perform comprehensive translation
            translated_content = self.comprehensive_translate(content)
            
            # Write back
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(translated_content)
            
            # Check if any Chinese remains
            remaining_chinese = re.findall(r'[\u4e00-\u9fff]', translated_content)
            if remaining_chinese:
                print(f"âš ï¸  Partial translation: {file_path.name} - {len(remaining_chinese)} characters remain")
                return "partial"
            else:
                print(f"âœ… Complete translation: {file_path.name}")
                return True
                
        except Exception as e:
            print(f"âŒ Error translating {file_path}: {e}")
            return False
    
    def translate_all_remaining(self):
        """Translate all files with remaining Chinese content"""
        md_files = list(self.base_path.rglob("*.md"))
        
        total_files = len(md_files)
        translated_files = 0
        partial_files = 0
        clean_files = 0
        
        print(f"Processing {total_files} markdown files...")
        
        for md_file in md_files:
            result = self.deep_translate_file(md_file)
            if result is True:
                translated_files += 1
            elif result == "partial":
                partial_files += 1
            elif result is False:
                clean_files += 1
        
        return {
            'total': total_files,
            'translated': translated_files, 
            'partial': partial_files,
            'clean': clean_files
        }

def main():
    """Main execution function"""
    base_path = Path("d:/repo/scrapes/converted_markdown")
    
    print("Enhanced EMV Data Translation")
    print("=" * 50)
    
    translator = EnhancedEMVTranslator(base_path)
    results = translator.translate_all_remaining()
    
    print(f"\nðŸ“Š Translation Results:")
    print(f"Total files: {results['total']}")
    print(f"âœ… Fully translated: {results['translated']}")
    print(f"âš ï¸  Partially translated: {results['partial']}")
    print(f"âœ¨ Already clean: {results['clean']}")
    
    if results['partial'] > 0:
        print(f"\nâš ï¸  {results['partial']} files have remaining Chinese characters")
        print("These may be complex phrases or technical terms requiring manual review")
    
    if results['translated'] > 0 or results['partial'] > 0:
        print(f"\nâœ… Enhanced translation completed!")
    else:
        print(f"\nâœ¨ All files were already fully translated!")

if __name__ == "__main__":
    main()