# GREENWIRE – Engineering Memory (2025-09-25)

This note captures the current state and key decisions so future work can pick up smoothly.

## Repo and branch

- Path: `d:\\repo\\GREENWIRE`
- Remote: [phawd/GREENWIRE](https://github.com/phawd/GREENWIRE) (default branch: main)
- Latest commit: 5c7072d (pushed on 2025-09-25)

## What’s working

- Python
  - Tests migrated to pytest; all tests passing (26/26) at last run.
- Static Java/JavaCard toolchain
  - Gradle configured for offline/local JARs via flatDir repositories (no network).
  - Bundled SDK JARs under `sdk/javacard/lib/`:
    - `api_classic.jar`
    - `tools.jar`
  - GlobalPlatform tools available locally:
    - `lib/GlobalPlatformPro.jar`
    - `static/java/gp.jar`
  - Convenience wrappers: `gp.ps1` / `gp.cmd` in repo root and `lib/`.
- Verification & docs
  - `tools/verify_java_static_setup.py` audits JavaCard/GP prerequisites and prints readiness.
  - README updated with “JavaCard: Offline .cap Build and Deploy (Gradle)” usage.
- CLI audit restored
  - `tool_audit.py` provides `greenwire.py audit-env` output with readiness keys (e.g., `javac_build_ready`, `pcsc_ready`).

## JavaCard Gradle tasks (javacard/applet/build.gradle)

- convertCap
  - Uses `com.sun.javacard.converter.Main` from `tools.jar`.
  - Parameterized via `-P` properties:
    - `appletClass` (e.g., com.example.MyApplet)
    - `packageName` (e.g., com.example)
    - `packageVersion` (e.g., 1.0)
    - `appletAID` (hex string, e.g., A000000001)
    - `packageAID` (hex string)
    - `exportPath` (folder with export files; default candidates searched under `sdk/javacard/api_export_files` etc.)
    - `classesDir` (compiled .class dir; defaults to `build/classes/java/main`)
  - Outputs to `javacard/applet/build/cap`.
- deployCap
  - Installs the most recent CAP in `build/cap` or a specific `-PcapFile` using `GlobalPlatformPro.jar`.
  - Depends on `convertCap` if no `capFile` is supplied.

## Typical workflow (PowerShell)

- Audit static toolchain:
  - `python tools/verify_java_static_setup.py`
- Build CAP (example):
  - `gradlew -p javacard/applet convertCap -PappletClass=com.example.MyApplet -PpackageName=com.example -PpackageVersion=1.0 -PappletAID=A000000001 -PpackageAID=A0000000FF`
  - If export files aren’t under default paths, add: `-PexportPath="sdk/javacard/api_export_files"`
- Deploy CAP (example):
  - `gradlew -p javacard/applet deployCap`
  - Or specify file: `gradlew -p javacard/applet deployCap -PcapFile=javacard/applet/build/cap/MyApplet.cap`

## Assumptions and notes

- Converter requires JavaCard export files; place them under `sdk/javacard/api_export_files` or pass `-PexportPath`.
- GlobalPlatform deploy requires a card and appropriate keys; the wrappers default to test flows and will fail without correct keys.
- Gradle builds are offline; all dependencies are expected to be present in-repo.

## Next steps (low-risk improvements)

- Add a small sample applet sources and a tiny Gradle task that compiles Java to classes before `convertCap`.
- Expand unit tests around CLI subcommands and any newly added modules.
- Optionally add a `gradle.properties.sample` documenting typical `-P` overrides.

---

Maintainer: autogenerated memory snapshot for 2025-09-25. Update or append a new dated note for future sessions.
